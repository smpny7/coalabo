---
title: "é¯–ç®¡å‘ã‘ï¼Minecraftã‚µãƒ¼ãƒãƒ¼ã®ç›£è¦–ãƒ„ãƒ¼ãƒ«ã®åˆ¶ä½œ"
description: "Cloud Functions for Firebase ã‚’ä½¿ã£ã¦ã€å®šæœŸå®Ÿè¡Œã™ã‚‹ç›£è¦–ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚"
date: 2021-06-01T00:00:00+21:00
slug: minecraft-server-monitor
image: cover.jpg
categories:
    - Firebase
    - Minecraft
tags:
    - ã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰
    - Botä½œæˆ
---

## ä»Šå›ã® Firebase ã¯ä¸€å‘³é•ã„ã¾ã™

ä»Šå›ä½œæˆã™ã‚‹ç›£è¦–ã‚µãƒ¼ãƒã§ã™ãŒã€Google Cloud Platform ã® Cloud Scheduler ã‚’ä½¿ã£ã¦ã€Firebase ã® Cloud Functions ã‚’å®šæœŸå®Ÿè¡Œã•ã›ã¾ã™ã€‚

Cloud Scheduler ã¨ Cloud Functions ã®é€£æºæ–¹æ³•ã§ã™ãŒã€
Google ãŒç”¨æ„ã—ã¦ã‚ã‚‹ `firebase-functions` ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä»˜éšã—ã¦ã„ã‚‹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€
è‡ªå‹•ã§ GCP ã® Cloud Scheduler ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚


## å¤©ä¸‹ã®Googleæ§˜æ§˜

Firebase ã§å®šæœŸå®Ÿè¡Œã£ã¦ã€ã‹ãªã‚Šé‡‘éŠ­çš„ãªã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šãã†ã§ã™ã‚ˆã­ã€‚

Web ã‚µãƒ¼ãƒãƒ¼ãªã©ã¨ã¯é•ã„ã€æ™‚é–“æŒ‡å®šã®ã‚ã‚‹ã‚¸ãƒ§ãƒ–ï¼ˆ Worker ï¼‰ã«ãªã‚‹ã®ã§ã€
çµæ§‹ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã‚‚å°‘ãªã„ã§ã™ã—ã€ä»Šå›ä½œæˆã™ã‚‹ç›£è¦–ã‚µãƒ¼ãƒãƒ¼ã¯10åˆ†æ¯ã«å®šæœŸå®Ÿè¡Œã—ã¾ã™ã€‚

**ã§ã™ãŒã€Cloud Functions ã§ã¯æœˆ200ä¸‡å›ã¾ã§ã®å‘¼ã³å‡ºã—ã¯ç„¡æ–™ã§ã™ï¼ï¼**

å…·ä½“çš„ã«ã€é–¢æ•°ã®å‘¼ã³å‡ºã—ã®èª²é‡‘ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

|   æœˆé–“å‘¼ã³å‡ºã—å›æ•°   |  æ–™é‡‘ï¼ˆ100 ä¸‡å›ã‚ãŸã‚Šï¼‰  |
|       :---:       |         :---:         |
|   æœ€åˆã® 200 ä¸‡å›   |         ç„¡æ–™          |
|  200 ä¸‡å›ã‚’è¶…ãˆãŸåˆ†  |        $0.40         |

ä»Šå›ã¯ã€ã‹ãªã‚Šè¤‡é›‘ãªDBã®æ•´å½¢ã‚¸ãƒ§ãƒ–ã‚„Webã‚µãƒ¼ãƒ“ã‚¹ã®CRONã‚¸ãƒ§ãƒ–ã‚’ã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€ç„¡æ–™æ ã§ååˆ†ã§ã™ã€‚

**ãŸã ã—æ°—ã‚’ã¤ã‘ãªã„ã¨ã„ã‘ãªã„ã®ãŒã€é–¢æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯æ–™é‡‘ãŒã‹ã‹ã‚Šã¾ã™ã€‚**

ã¾ãšã€é–¢æ•°ã¯ç„¡æ–™æ ã®ãªã„ Container Registry ã«ä¿å­˜ã•ã‚Œã‚‹ãŸã‚ã€ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ã‚ãšã‹ãªæ–™é‡‘ãŒç™ºç”Ÿã—ã¾ã™ã€‚
Container Registry ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è²»ç”¨ã¯ã€1 GB ã‚ãŸã‚Šæœˆé¡ç´„ $0.026 ã§ã™ã€‚

ãã—ã¦ã€é–¢æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã”ã¨ã«ç´„ 1 åˆ†ã® Cloud Build ã«ã‚ˆã‚‹å‡¦ç†ãŒè¡Œã‚ã‚Œã¾ã™ã€‚
æ–™é‡‘ã¯ $0.003/ãƒ“ãƒ«ãƒ‰åˆ† ã§ã™ãŒã€1 æ—¥ã‚ãŸã‚Šæœ€åˆã® 120 ãƒ“ãƒ«ãƒ‰åˆ†ã¯ç„¡æ–™ã§ã™ã€‚

ã¯ã„ã€ã‚‚ã†ã»ã¨ã‚“ã©ç„¡æ–™ã§ã™ã­ã€‚

Firebase ã®æ–™é‡‘ãƒ—ãƒ©ãƒ³ã¯ã€Spark â†’ Blaze ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸã€æœ‰åŠ¹ãªæ”¯æ‰•ã„æ–¹æ³•ã‚’ç™»éŒ²ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

![Firebase æ–™é‡‘ãƒ—ãƒ©ãƒ³](image_1.jpg)


## Cloud Functions ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

Cloud Functions ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯ã€Firebase CLI ã‚’å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```shell
$ npm install -g firebase-tools
```

ãŠä½¿ã„ã® Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```shell
$ firebase login
```

æœ€å¾Œã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ–°è¦ä½œæˆã™ã‚‹ã«ã¯

```shell
$ firebase init
```

ã§æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã§ãã¾ã™ã€‚ãŒ...


## firebase init ã§ãƒãƒã£ãŸï¼

`firebase init` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãªã«ã‚„ã‚‰ä¸ç©ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¾ã™ã€‚

> Error: Cloud resource location is not set for this project but the operation you are attempting to perform in Cloud Firestore requires it. Please see this documentation for more details: https://firebase.google.com/docs/projects/locations .

æ–°è¦ Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ã¯ã€åˆã‚ã«ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã—ã¦ãŠã‹ãªã„ã¨ã„ã‘ãªã„ãã†ã§ã™ï¼

![ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® GCP ãƒªã‚½ãƒ¼ã‚¹ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚’è¨­å®š](image_2.jpg)

GCP ãƒªã‚½ãƒ¼ã‚¹ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ä¸€åº¦è¨­å®šã™ã‚‹ã¨å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ããªã„ã®ã§æ³¨æ„ã§ã™ï¼

| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åï¼ˆTier 1ï¼‰ | åœ°åŸŸ |
| :--- | :--- |
| us-central1 | ã‚¢ã‚¤ã‚ªãƒ¯ |
| us-east1 | ã‚µã‚¦ã‚¹ã‚«ãƒ­ãƒ©ã‚¤ãƒŠ |
| us-east4 | åŒ—ãƒãƒ¼ã‚¸ãƒ‹ã‚¢ |
| europe-west1 | ãƒ™ãƒ«ã‚®ãƒ¼ |
| europe-west2 | ãƒ­ãƒ³ãƒ‰ãƒ³ |
| asia-east2 | é¦™æ¸¯ |
| asia-northeast1 | æ±äº¬ |
| asia-northeast2 | å¤§é˜ª |

ç„¡é›£ã«ã€`asia-northeast1` ã‹ `asia-northeast2` ã‚ãŸã‚ŠãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚

ã“ã‚Œã§ãã¡ã‚“ã¨æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆãŒã§ãã¾ã—ãŸï¼

![Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–°è¦ä½œæˆ](image_3.png)


## Cloud Functions ã®ç’°å¢ƒå¤‰æ•°ã«ã¤ã„ã¦

Cloud Functions ã«ã¯ã€ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã§ãã‚‹ã®ã§ã™ãŒã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã«ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ãã¾ã™ã€‚

ä¾‹ãˆã°ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€`address` ã¨ `port` ã¨ã„ã†ç’°å¢ƒå¤‰æ•°ãŒå¿…è¦ã«ãªã‚‹ã®ã§ã™ãŒã€

```shell
$ firebase functions:config:set server.address="minecraft-sample-server.com" server.port="25565"
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã§ãã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç’°å¢ƒæ§‹æˆã«ç¾åœ¨ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’èª¿ã¹ã‚‹ã«ã¯ã€
```shell
$ firebase functions:config:get
```
ã§ã€JSON ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚


## ç’°å¢ƒå¤‰æ•°ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆæ™‚ã«ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹

Cloud Functions ã®ç’°å¢ƒå¤‰æ•°ã‚’ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆæ™‚ã«ã‚‚ä½¿ã†ã“ã¨ã¯å¤šã„ã¨æ€ã„ã¾ã™ã€‚

èª¿ã¹ã¦ã¿ãŸã¨ã“ã‚ã€`.runtimeconfig.json` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ç’°å¢ƒå¤‰æ•°ã® JSON ã‚’å‡ºåŠ›ã—ã¦
`functions` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«ç½®ã„ã¦ãŠãã“ã¨ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚ç’°å¢ƒå¤‰æ•°ã‚’å–ã‚Šè¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ãã†ã§ã™ã€‚

```shell
$ firebase functions:config:get > .runtimeconfig.json
```


## ä»Šå›ä½œæˆã—ãŸã‚‚ã®

Minecraft ã‚µãƒ¼ãƒãƒ¼ã‚’ç›£è¦–ã—ã€ã‚µãƒ¼ãƒãƒ¼ãŒè½ã¡ãŸéš›ã« Discord ã«é€šçŸ¥ã—ã¦ãã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆWorkerï¼‰ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

è©³ã—ãã¯ä»¥ä¸‹ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼

![minecraft-server-monitor (README)](image_4.jpg)
> [minecraft-server-monitor](https://github.com/smpny7/minecraft-server-monitor)ã€€Monitor your Minecraft server and let Discord know the status ğŸ–¥


## Discord ã® æƒ…ã‚¯ãƒ© (minecraftã‚µãƒ¼ãƒãƒ¼) ãƒãƒ£ãƒ³ãƒãƒ«

Discord ã«ã‚µãƒ¼ãƒã®çŠ¶æ…‹ã‚’ãƒ­ã‚°ã¨ã—ã¦æŠ•ã’ã¦ãã‚Œã¾ã™ã€‚

ãƒœãƒƒãƒˆã®åå‰ã¨ã‚¢ã‚¤ã‚³ãƒ³ã¯ã€ãƒ¡ãƒ³ãƒãƒ¼ã«å‹æ‰‹ã«å¤‰ãˆã‚‰ã‚Œã¦ã„ã‚‹ã®ã§æ°—ã«ã—ãªã„ã§ãã ã•ã„ã€‚ã€‚

![ä¸€èˆ¬çš„ãªãƒ­ã‚°](image_5.jpg)

ã¾ãŸã€GCP ã® minecraft ã‚µãƒ¼ãƒãƒ¼ãŒè½ã¡ãŸã¨ãã¯ã€é€šçŸ¥ç”¨ãƒãƒ£ãƒ³ãƒãƒ«ã«æŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚

![ã‚µãƒ¼ãƒãƒ¼ãŒè½ã¡ãŸæ™‚ã®ãƒ­ã‚°](image_6.jpg)


## ãŠã‚ã‚Šã«

Firebase ã¯æœ€é«˜ã§ã™ã­ï¼